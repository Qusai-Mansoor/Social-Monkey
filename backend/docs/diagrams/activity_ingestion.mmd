%% Activity Diagram - SocialMonkey Data Processing Pipeline
%% Iteration 1: OAuth, Data Ingestion, Text Preprocessing, Basic UI
%% Iteration 2: Emotion Analysis (Module 2), Slang Detection (Module 3), Advanced Analytics

stateDiagram-v2
    [*] --> UserLogin: Start
    UserLogin --> Dashboard: Authentication Success
    
    Dashboard --> CheckConnection: Load Dashboard
    CheckConnection --> OAuthFlow: Account Not Connected
    CheckConnection --> DataIngestion: Account Connected
    
    state OAuthFlow {
        [*] --> InitiateOAuth: User Clicks Connect
        InitiateOAuth --> UserAuthorization: Generate OAuth URL
        UserAuthorization --> TokenExchange: User Approves
        TokenExchange --> StoreCredentials: Exchange Code for Token
        StoreCredentials --> [*]: Connection Success
    }
    
    OAuthFlow --> Dashboard: Return to Dashboard
    
    state DataIngestion {
        [*] --> VerifyAccount: User Triggers Sync
        VerifyAccount --> CheckPlatform: Validate Ownership
        
        state CheckPlatform <<choice>>
        CheckPlatform --> FetchData: Supported Platform
        CheckPlatform --> [*]: Unsupported Platform
        
        FetchData --> ProcessPosts: Retrieve Posts & Comments
        ProcessPosts --> fork_process
        
        state fork_process <<fork>>
        fork_process --> TextPreprocessing
        fork_process --> EmotionAnalysis
        fork_process --> SlangDetection
        
        state TextPreprocessing {
            [*] --> CleanText: Normalize Content
            CleanText --> DetectLanguage
            DetectLanguage --> [*]
        }
        
        state EmotionAnalysis {
            [*] --> AnalyzeEmotion: AI Model Processing
            AnalyzeEmotion --> CalculateSentiment
            CalculateSentiment --> [*]: Store Emotion Scores
        }
        
        state SlangDetection {
            [*] --> ScanSlang: Pattern Matching
            ScanSlang --> ExtractTerms
            ExtractTerms --> [*]: Store Slang Data
        }
        
        state join_process <<join>>
        TextPreprocessing --> join_process
        EmotionAnalysis --> join_process
        SlangDetection --> join_process
        
        join_process --> StoreDatabase: Save Processed Data
        StoreDatabase --> CheckMore
        
        state CheckMore <<choice>>
        CheckMore --> FetchData: More Data Available
        CheckMore --> GenerateAnalytics: Processing Complete
        
        GenerateAnalytics --> [*]: Return Statistics
    }
    
    DataIngestion --> UpdateDashboard: Ingestion Complete
    
    state UpdateDashboard {
        [*] --> CalculateMetrics: Aggregate Data
        CalculateMetrics --> RenderCharts: Compute Trends
        RenderCharts --> DisplayResults: Update UI
        DisplayResults --> [*]
    }
    
    UpdateDashboard --> Dashboard: Refresh View
    Dashboard --> [*]: User Logout

